image: docker:18.09
services:
- docker:18.09-dind

variables:
  DOCKER_DRIVER: overlay
  SPRING_PROFILES_ACTIVE: gitlab-ci

stages:
- build
- test
#- package
#- deploy

maven-build:
  image: maven:3-jdk-8
  stage: build
  script:
  - mvn -Dmaven.test.skip=true package -B > build.log
  - mvn test-compile
  artifacts:
    paths:
    - target/*
    - build.log

maven-test:
  image: maven:3-jdk-8
  stage: test
  script:
  - mvn surefire:test > test.log
  artifacts:
    paths:
    - test.log

#docker-build:
#  stage: package
#  script:
#  - docker build -t registry.gitlab.com/italiandevopsgroup/petclinic .
#  - docker login -u gitlab-ci-token -p $CI_BUILD_TOKEN registry.gitlab.com
#  - docker push registry.gitlab.com/italiandevopsgroup/petclinic


